# 🎖️ 超级管理员功能完整指南

## 功能概述

超级管理员是系统中的最高权限级别，拥有对整个系统的完全控制权。超级管理员可以管理其他管理员、普通用户、系统物品，以及直接修改用户数据。

## 权限层级

```
🎖️ 超级管理员 (Super Admin)
    ├── 管理所有管理员账户
    ├── 管理所有普通用户账户
    ├── 管理系统物品
    ├── 修改用户货币和库存
    └── 拥有所有管理员权限
    
🛠️ 管理员 (Admin)
    ├── 管理卡池
    ├── 管理卡池中的物品权重
    ├── 查看系统统计
    └── 无法管理用户和系统物品
    
👤 普通用户 (User)
    ├── 抽卡
    ├── 充值
    ├── 查看背包
    └── 查看历史记录
```

## API 端点详解

### 1. 管理员管理

#### 查看所有管理员
```http
GET /api/super-admin/admins?super_admin_id=1
```

#### 创建新管理员
```http
POST /api/super-admin/admins
Content-Type: application/json

{
  "super_admin_id": 1,
  "name": "管理员姓名",
  "account": "admin_account",
  "password": "admin_password"
}
```

#### 删除管理员
```http
DELETE /api/super-admin/admins/{admin_id}
Content-Type: application/json

{
  "super_admin_id": 1
}
```

### 2. 超级管理员管理

#### 查看所有超级管理员
```http
GET /api/super-admin/super-admins?super_admin_id=1
```

#### 创建新超级管理员
```http
POST /api/super-admin/super-admins
Content-Type: application/json

{
  "super_admin_id": 1,
  "name": "超级管理员姓名",
  "account": "super_admin_account",
  "password": "super_admin_password"
}
```

#### 删除超级管理员
```http
DELETE /api/super-admin/super-admins/{admin_id}
Content-Type: application/json

{
  "super_admin_id": 1
}
```

**安全限制:**
- 不能删除自己
- 系统至少保留一个超级管理员

### 3. 用户管理

#### 创建新用户
```http
POST /api/super-admin/users
Content-Type: application/json

{
  "super_admin_id": 1,
  "name": "用户姓名",
  "account": "user_account",
  "password": "user_password",
  "coins": 5000  // 可选，默认2000
}
```

#### 删除用户
```http
DELETE /api/super-admin/users/{user_id}
Content-Type: application/json

{
  "super_admin_id": 1
}
```

#### 修改用户货币
```http
PUT /api/super-admin/users/{user_id}/coins
Content-Type: application/json

{
  "super_admin_id": 1,
  "coins": 10000
}
```

#### 修改用户库存
```http
PUT /api/super-admin/users/{user_id}/inventory
Content-Type: application/json

{
  "super_admin_id": 1,
  "item_id": 1,
  "quantity": 10  // 设为0可删除物品
}
```

### 4. 物品系统管理

#### 创建新物品
```http
POST /api/super-admin/items
Content-Type: application/json

{
  "super_admin_id": 1,
  "name": "物品名称",
  "description": "物品描述",
  "weight": 20,
  "rarity": "稀有",
  "type": "武器"
}
```

#### 修改物品信息
```http
PUT /api/super-admin/items/{item_id}
Content-Type: application/json

{
  "super_admin_id": 1,
  "name": "新物品名称",
  "description": "新描述",
  "weight": 25,
  "rarity": "史诗",
  "type": "装备"
}
```

#### 删除物品
```http
DELETE /api/super-admin/items/{item_id}
Content-Type: application/json

{
  "super_admin_id": 1
}
```

**影响范围:**
- 删除物品会同时从所有卡池中移除
- 删除物品会清除所有用户的对应库存

## 使用场景示例

### 场景1: 设置新的游戏管理团队

1. **创建管理员账户**
```bash
curl -X POST http://127.0.0.1:5000/api/super-admin/admins \
  -H "Content-Type: application/json" \
  -d '{
    "super_admin_id": 1,
    "name": "张三",
    "account": "zhang_san",
    "password": "admin123"
  }'
```

2. **验证管理员可以登录**
```bash
curl -X POST http://127.0.0.1:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "account": "zhang_san",
    "password": "admin123"
  }'
```

### 场景2: 为特殊活动创建限量物品

1. **创建活动物品**
```bash
curl -X POST http://127.0.0.1:5000/api/super-admin/items \
  -H "Content-Type: application/json" \
  -d '{
    "super_admin_id": 1,
    "name": "新年限定徽章",
    "description": "2025年新年活动限定纪念品",
    "weight": 0.01,
    "rarity": "神话",
    "type": "纪念品"
  }'
```

2. **直接发放给特定用户**
```bash
curl -X PUT http://127.0.0.1:5000/api/super-admin/users/2/inventory \
  -H "Content-Type: application/json" \
  -d '{
    "super_admin_id": 1,
    "item_id": 16,
    "quantity": 1
  }'
```

### 场景3: 处理用户问题

1. **给用户补偿货币**
```bash
curl -X PUT http://127.0.0.1:5000/api/super-admin/users/3/coins \
  -H "Content-Type: application/json" \
  -d '{
    "super_admin_id": 1,
    "coins": 15000
  }'
```

2. **为用户补发丢失的物品**
```bash
curl -X PUT http://127.0.0.1:5000/api/super-admin/users/3/inventory \
  -H "Content-Type: application/json" \
  -d '{
    "super_admin_id": 1,
    "item_id": 1,
    "quantity": 3
  }'
```

## 安全注意事项

### 权限验证
- 所有超级管理员API都需要有效的 `super_admin_id`
- 系统会验证该ID是否确实是超级管理员
- 无权限访问会返回403错误

### 账号安全
- 账号不能重复（超级管理员、管理员、用户之间都不能重复）
- 建议使用强密码
- 定期检查和清理不必要的账户

### 数据完整性
- 删除操作会级联影响相关数据
- 删除物品前确保不会影响正在进行的活动
- 删除用户前考虑是否保留历史数据

### 系统稳定性
- 确保至少保留一个超级管理员
- 不能删除自己的超级管理员账户
- 重要操作建议先在测试环境验证

## 测试脚本

### 运行完整的超级管理员功能测试
```bash
python test_super_admin.py
```

### 运行登录和角色识别测试
```bash
python test_login.py
```

### 测试输出示例
```
🎯 超级管理员功能测试
==================================================
✅ 管理员管理 (查看/创建/删除)
✅ 超级管理员管理 (查看/创建/删除)
✅ 用户管理 (创建/删除/修改货币/修改库存)
✅ 物品管理 (创建/修改/删除)
✅ 权限验证 (未授权访问控制)
```

## 错误码说明

| 状态码 | 错误类型 | 描述 |
|-------|---------|------|
| 400 | Bad Request | 缺少必要参数或参数格式错误 |
| 401 | Unauthorized | 账号或密码错误 |
| 403 | Forbidden | 权限不足，不是超级管理员 |
| 404 | Not Found | 目标用户/管理员/物品不存在 |
| 409 | Conflict | 账号已存在或其他冲突 |
| 200/201 | Success | 操作成功 |

## 最佳实践

1. **定期备份**: 虽然当前使用内存存储，但在生产环境中应定期备份数据库
2. **权限最小化**: 只给需要的人员分配超级管理员权限
3. **操作日志**: 记录所有超级管理员操作，便于审计和问题追踪
4. **测试先行**: 重要操作前先在测试环境验证
5. **权限分离**: 考虑将不同类型的管理权限分配给不同的管理员

---

> **注意**: 当前系统使用内存存储，重启服务器后数据会丢失。在生产环境中应该使用持久化数据库存储。
